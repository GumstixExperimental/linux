/*
* Copyright (C) 2017 Gumstix, Inc. - https://www.gumstix.com/
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License version 2 as
* published by the Free Software Foundation.
*/

/dts-v1/;

#include <dt-bindings/input/input.h>
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/gpio/gpio.h>
#define PIN_INPUT 0x1b0b1
#include "imx6q.dtsi"

/ {
    model = "iMX6dql Gumstix Overo on Geppetto - SCMIMX Test";
    compatible = "gumstix,imx6-scmimx-test", "gumstix,imx_scm", "fsl,imx6q";

    sound-hdmi {
		compatible = "fsl,imx6q-audio-hdmi", "fsl,imx-audio-hdmi";
		model = "imx-audio-hdmi";
		hdmi-controller = <&hdmi_audio>;
	};
    aliases {
		mxcfb0 = &mxcfb1;
		mxcfb1 = &mxcfb2;
		mxcfb2 = &mxcfb3;
		mxcfb3 = &mxcfb4;
	};

    soc {
        busfreq {
            fsl,max_ddr_freq = <400000000>;
            status = "okay";
        };
    };


	chosen {
		stdout-path = &uart1;
	};

	memory: memory {
		linux,usable-memory = <0x10000000 0x20000000
			       0x80000000 0x20000000>;
		reg = <0x10000000 0x40000000>;
	};

	regulators {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		reg_usb_otg_vbus: regulator@0 {
			compatible = "regulator-fixed";
			reg = <0>;
			regulator-name = "usb_otg_vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			gpio = <&gpio4 15 0>;
			enable-active-high;
		};
	};


	mxcfb1: fb@0 {
		compatible = "fsl,mxc_sdc_fb";
		disp_dev = "hdmi";
		interface_pix_fmt = "RGB24";
		mode_str ="1920x1080M@60";
		default_bpp = <24>;
		int_clk = <0>;
		late_init = <0>;
		status = "disabled";
	};

	mxcfb2: fb@1 {
		compatible = "fsl,mxc_sdc_fb";
		disp_dev = "hdmi";
		interface_pix_fmt = "RGB24";
		mode_str ="1920x1080M@60";
		default_bpp = <24>;
		int_clk = <0>;
		late_init = <0>;
		status = "disabled";
	};

	mxcfb3: fb@2 {
		compatible = "fsl,mxc_sdc_fb";
		disp_dev = "lcd";
		interface_pix_fmt = "RGB565";
		mode_str ="CLAA-WVGA";
		default_bpp = <16>;
		int_clk = <0>;
		late_init = <0>;
		status = "disabled";
	};

	mxcfb4: fb@3 {
		compatible = "fsl,mxc_sdc_fb";
		disp_dev = "ldb";
		interface_pix_fmt = "RGB666";
		default_bpp = <16>;
		int_clk = <0>;
		late_init = <0>;
		status = "disabled";
	};


    mcasp: mcasp {
        status = "disabled";
    };

    sound: sound_iface {
        status = "okay";
        compatible = "ti,da830-evm-audio";
        ti,mcasp-controller = <&mcasp>;
        ti,audio-routing = "Headphone Jack",
		"HPLOUT",
		"Headphone Jack",
		"HPROUT",
		"LINE1L",
		"Line In",
		"LINE1R",
		"Line In";
        ti,audio-codec = "audio_codec";
        ti,model = "AM437x-SK-EVM";
        ti,codec-clock-rate = <12000000>;
    };
    gpio_header_219779 {
        status = "okay";
        pinctrl-names = "default";
        pinctrl-0 = <&gpio_header_219779_default>;
        type = "gpio_header";

        gpio_header_0 {
            label = "gpio_header_0";
            type = "gpio_header";
            gpios = <&gpio5 18 0>;
            gpio-hog;
            input;
        };

        gpio_header_1 {
            label = "gpio_header_1";
            type = "gpio_header";
            gpios = <&gpio5 19 0>;
            gpio-hog;
            input;
        };

        gpio_header_2 {
            label = "gpio_header_2";
            type = "gpio_header";
            gpios = <&gpio5 20 0>;
            gpio-hog;
            input;
        };

        gpio_header_3 {
            label = "gpio_header_3";
            type = "gpio_header";
            gpios = <&gpio5 5 0>;
            gpio-hog;
            input;
        };

        gpio_header_4 {
            label = "gpio_header_4";
            type = "gpio_header";
            gpios = <&gpio5 9 0>;
            gpio-hog;
            input;
        };

        gpio_header_5 {
            label = "gpio_header_5";
            type = "gpio_header";
            gpios = <&gpio1 27 0>;
            gpio-hog;
            input;
        };

        gpio_header_6 {
            label = "gpio_header_6";
            type = "gpio_header";
            gpios = <&gpio1 30 0>;
            gpio-hog;
            input;
        };

        gpio_header_7 {
            label = "gpio_header_7";
            type = "gpio_header";
            gpios = <&gpio2 31 0>;
            gpio-hog;
            input;
        };
    };

};


&cpu0 {
	arm-supply = <&reg_arm>;
	soc-supply = <&reg_soc>;
};

&clks {
	fsl,ldb-di0-parent = <&clks IMX6QDL_CLK_PLL2_PFD0_352M>;
	fsl,ldb-di1-parent = <&clks IMX6QDL_CLK_PLL2_PFD0_352M>;
};

&ecspi1 {
	fsl,spi-num-chipselects = <1>;
	cs-gpios = <&gpio2 30 0>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_ecspi1>;
	status = "okay";
	flash: m25p80@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "micron,n25q128a13";
		spi-max-frequency = <20000000>;
		reg = <0>;
	};
};



&i2c2 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c2>;
	status = "okay";

	pmic: pfuze100@08 {
		compatible = "fsl,pfuze100";
		reg = <0x08>;
		regulators {
			sw1a_reg: sw1ab {
				regulator-min-microvolt = <300000>;
				regulator-max-microvolt = <1875000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <6250>;
			};

			sw1c_reg: sw1c {
				regulator-min-microvolt = <300000>;
				regulator-max-microvolt = <1875000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <6250>;
			};

			sw2_reg: sw2 {
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw3a_reg: sw3a {
				regulator-min-microvolt = <400000>;
				regulator-max-microvolt = <1200000>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw3b_reg: sw3b {
				regulator-min-microvolt = <400000>;
				regulator-max-microvolt = <1200000>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw4_reg: sw4 {
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			swbst_reg: swbst {
				regulator-min-microvolt = <5000000>;
				regulator-max-microvolt = <5150000>;
				regulator-boot-on;
				regulator-always-on;
			};

			snvs_reg: vsnvs {
				regulator-min-microvolt = <1000000>;
				regulator-max-microvolt = <3000000>;
				regulator-boot-on;
				regulator-always-on;
			};

			vref_reg: vrefddr {
				regulator-boot-on;
				regulator-always-on;
			};

			vgen1_reg: vgen1 {
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <1550000>;
				regulator-always-on;
			};

			vgen2_reg: vgen2 {
				regulator-min-microvolt = <0x16e360>;
				regulator-max-microvolt = <0x16e360>;
				regulator-always-on;
			};

			vgen3_reg: vgen3 {
				regulator-min-microvolt = <0x325aa0>;
				regulator-max-microvolt = <0x325aa0>;
				regulator-always-on;
			};

			vgen4_reg: vgen4 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <2500000>;
				regulator-always-on;
			};

			vgen5_reg: vgen5 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
			};

			vgen6_reg: vgen6 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3150000>;
				regulator-always-on;
			};
		};
	};
};

&usbotg {
	vbus-supply = <&reg_usb_otg_vbus>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usbotg>;
	disable-over-current;
	srp-disable;
	hnp-disable;
	adp-disable;
	status = "okay";
};

&usbphy1 {
	tx-d-cal = <0x5>;
};

&usbphy2 {
	tx-d-cal = <0x5>;
};

&usbh1 {
	status = "okay";
};

&usbh2 {
	status = "okay";
};

&ecspi1 {
	fsl,spi-num-chipselects = <1>;
	cs-gpios = <&gpio2 30 0>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_ecspi1>;
	status = "okay";
	flash: m25p80@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "micron,n25q128a13";
		spi-max-frequency = <20000000>;
		reg = <0>;
	};
};
&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};



&usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usdhc2>;
	bus-width = <4>;
	cd-gpios = <&gpio1 4 GPIO_ACTIVE_LOW>;
	no-1-8-v;
	keep-power-in-suspend;
	enable-sdio-wakeup;
	status = "okay";
};

&gpc {
	/* use ldo-enable, u-boot will check it and configure */
	fsl,ldo-bypass = <0>;
	/* watchdog select of reset source */
	fsl,wdog-reset = <1>;
};

&wdog1 {
	status = "okay";
};

&wdog2 {
	status = "disabled";
};

&fec {
	local-mac-address = [06 CD 8C E9 08 0D];
};


// spi_buses device

&ecspi3 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&ecspi3_default>;
    type = "spi";

        spidev {
            compatible = "spidev";
            type = "spi";
    
            interrupt-parent = <&gpio4>;
            interrupts =<19 0>;
        };
};

// uart1 device

&uart1 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart1_default>;
    type = "uart";
};

// asp device

&mcasp {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&audio_default>;
    op-mode = <0>;
    tx-num-evt = <1>;
    rx-num-evt = <1>;
    serial-dir = <1 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
    tdm-slots = <2>;
    type = "audio";
};

// usb device


// i2c_buses device

&i2c1 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&i2c1_default>;
    clock-frequency = <400000>;

        audio_codec: audio_codec@1b {
            reg = <27>;
            compatible = "ti,tlv320aic3106";
            ai3x-micbias-vg = <2>;
            type = "audio";
            gpio-reset = <&gpio4 16 GPIO_ACTIVE_LOW>;
        };
};
&i2c3 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&i2c3_default>;
    clock-frequency = <400000>;
};


&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_hog>;

	imx6qdl-geppetto {
		pinctrl_hog: hoggrp {
			fsl,pins = <
				MX6QDL_PAD_NANDF_D0__GPIO2_IO00 0x80000000
				MX6QDL_PAD_NANDF_CS1__GPIO6_IO14 0x80000000
				MX6QDL_PAD_NANDF_CS2__GPIO6_IO15 0x80000000
				MX6QDL_PAD_KEY_COL2__GPIO4_IO10 0x80000000
				MX6QDL_PAD_EIM_EB2__GPIO2_IO30 0x80000000
				MX6QDL_PAD_EIM_D22__GPIO3_IO22  0x80000000
			>;
		};
		pinctrl_usbotg: usbotggrp {
			fsl,pins = <
				MX6QDL_PAD_GPIO_1__USB_OTG_ID		0x17059
				MX6QDL_PAD_KEY_ROW4__GPIO4_IO15		0x17059
			>;
		};
		pinctrl_ecspi1: ecspi1grp {
			fsl,pins = <
				MX6QDL_PAD_EIM_D17__ECSPI1_MISO 0x100b1
				MX6QDL_PAD_EIM_D18__ECSPI1_MOSI 0x100b1
				MX6QDL_PAD_EIM_D16__ECSPI1_SCLK 0x100b1
			>;
		};


		pinctrl_i2c2: i2c2grp {
			fsl,pins = <
				MX6QDL_PAD_KEY_COL3__I2C2_SCL	0x4001b8b1
				MX6QDL_PAD_KEY_ROW3__I2C2_SDA	0x4001b8b1
			 >;
		};
		pinctrl_uart1: uart1grp {
			fsl,pins = <
				MX6QDL_PAD_CSI0_DAT10__UART1_TX_DATA	0x1b0b1
				MX6QDL_PAD_CSI0_DAT11__UART1_RX_DATA	0x1b0b1
			>;
		};

		pinctrl_usdhc2: usdhc2grp {
			fsl,pins = <
				MX6QDL_PAD_SD2_CMD__SD2_CMD		0x17059
				MX6QDL_PAD_SD2_CLK__SD2_CLK		0x10059
				MX6QDL_PAD_SD2_DAT0__SD2_DATA0		0x17059
				MX6QDL_PAD_SD2_DAT1__SD2_DATA1		0x17059
				MX6QDL_PAD_SD2_DAT2__SD2_DATA2		0x17059
				MX6QDL_PAD_SD2_DAT3__SD2_DATA3		0x17059
			>;
		};

	};
};
&iomuxc {
    geppetto {
        i2c3_default: i2c3grp {
            fsl,pins = <
                MX6QDL_PAD_GPIO_5__I2C3_SCL PIN_INPUT /* gpio_5.i2c3_scl */
            >;
        };
        i2c1_default: i2c1grp {
            fsl,pins = <
                MX6QDL_PAD_EIM_D28__I2C1_SDA PIN_INPUT /* eim_d28.i2c1_sda */
                MX6QDL_PAD_DI0_DISP_CLK__GPIO4_IO16 PIN_INPUT /* di0_disp_clk.gpio4_io16 */
            >;
        };
        audio_default: audiogrp {
            fsl,pins = <
                MX6QDL_PAD_DISP0_DAT20__AUD4_TXC PIN_INPUT /* disp0_dat20.aud4_txc */
                MX6QDL_PAD_DISP0_DAT21__AUD4_TXD PIN_INPUT /* disp0_dat21.aud4_txd */
                MX6QDL_PAD_DISP0_DAT23__AUD4_RXD PIN_INPUT /* disp0_dat23.aud4_rxd */
                MX6QDL_PAD_DISP0_DAT22__AUD4_TXFS PIN_INPUT /* disp0_dat22.aud4_txfs */
            >;
        };
        root_gpios_default: root_gpiosgrp {
            fsl,pins = <
                NONEDI0_PIN3__GPIO4_IO19 PIN_INPUT /* di0_pin3.gpio4_io19 */
            >;
        };
        uart1_default: uart1grp {
            fsl,pins = <
                MX6QDL_PAD_SD3_DAT0__UART1_CTS_B PIN_INPUT /* sd3_dat0.uart1_cts_b */
                MX6QDL_PAD_SD3_DAT6__UART1_RX_DATA PIN_INPUT /* sd3_dat6.uart1_rx_data */
            >;
        };
        ecspi3_default: ecspi3grp {
            fsl,pins = <
                MX6QDL_PAD_DISP0_DAT0__ECSPI3_SCLK PIN_INPUT /* disp0_dat0.ecspi3_sclk */
                MX6QDL_PAD_DISP0_DAT3__ECSPI3_SS0 PIN_INPUT /* disp0_dat3.ecspi3_ss0 */
                MX6QDL_PAD_DISP0_DAT4__ECSPI3_SS1 PIN_INPUT /* disp0_dat4.ecspi3_ss1 */
                MX6QDL_PAD_DISP0_DAT2__ECSPI3_MISO PIN_INPUT /* disp0_dat2.ecspi3_miso */
                MX6QDL_PAD_DISP0_DAT1__ECSPI3_MOSI PIN_INPUT /* disp0_dat1.ecspi3_mosi */
            >;
        };
        gpio_header_219779_default: gpio_header_219779grp {
            fsl,pins = <
                MX6QDL_PAD_CSI0_PIXCLK__GPIO5_IO18 PIN_INPUT /* csi0_pixclk.gpio5_io18 */
                MX6QDL_PAD_CSI0_MCLK__GPIO5_IO19 PIN_INPUT /* csi0_mclk.gpio5_io19 */
                MX6QDL_PAD_CSI0_DATA_EN__GPIO5_IO20 PIN_INPUT /* csi0_data_en.gpio5_io20 */
                MX6QDL_PAD_DISP0_DAT11__GPIO5_IO05 PIN_INPUT /* disp0_dat11.gpio5_io05 */
                MX6QDL_PAD_DISP0_DAT15__GPIO5_IO09 PIN_INPUT /* disp0_dat15.gpio5_io09 */
                MX6QDL_PAD_ENET_RXD0__GPIO1_IO27 PIN_INPUT /* enet_rxd0.gpio1_io27 */
                MX6QDL_PAD_ENET_TXD0__GPIO1_IO30 PIN_INPUT /* enet_txd0.gpio1_io30 */
                MX6QDL_PAD_EIM_EB3__GPIO2_IO31 PIN_INPUT /* eim_eb3.gpio2_io31 */
            >;
        };
    };
};